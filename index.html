<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãƒªã‚¹ãƒˆ_ã¡ã‚‡ã“ã£ã¨è‡ªç„¶è¾² -try natural farming-</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
      }
      .sort-container {
        margin-bottom: 10px;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }
      .panel {
        border: 1px solid #ddd;
        padding: 10px;
        width: 250px;
        border-radius: 5px;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        text-align: left;
        background-color: #f9f9f9;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .panel:hover {
        transform: scale(1.05);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
      }
      .panel a {
        text-decoration: none;
        color: black;
        display: block;
        padding: 10px;
      }
      /* æ¤œç´¢çª“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #searchInput {
        width: 300px; /* å¹…ã‚’åºƒã’ã‚‹ */
        padding: 8px;
        font-size: 16px;
        margin-right: 10px;
      }
      /* ã‚½ãƒ¼ãƒˆçª“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #sortSelect {
        width: 200px; /* å¹…ã‚’åºƒã’ã‚‹ */
        padding: 8px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h2>ãƒªã‚¹ãƒˆ_ã¡ã‚‡ã“ã£ã¨è‡ªç„¶è¾² -try natural farming-</h2>

    <!-- æ¤œç´¢çª“ -->
    <div>
      <input
        type="text"
        id="searchInput"
        placeholder="ANDæ¤œç´¢: è¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
      />
      <button onclick="filterData()">æ¤œç´¢</button>
      <!-- æ¤œç´¢ãƒœã‚¿ãƒ³ -->
    </div>

    <!-- ã‚½ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="sort-container">
      <label for="sortSelect">ã‚½ãƒ¼ãƒˆé †:</label>
      <select id="sortSelect">
        <option value="date-desc">å…¬é–‹æ—¥ (æ–°ã—ã„é †)</option>
        <option value="date-asc">å…¬é–‹æ—¥ (å¤ã„é †)</option>
        <option value="views-desc">å†ç”Ÿæ•° (å¤šã„é †)</option>
        <option value="views-asc">å†ç”Ÿæ•° (å°‘ãªã„é †)</option>
        <option value="likes-desc">ã„ã„ã­ (å¤šã„é †)</option>
        <option value="likes-asc">ã„ã„ã­ (å°‘ãªã„é †)</option>
        <option value="comments-desc">ã‚³ãƒ¡ãƒ³ãƒˆ (å¤šã„é †)</option>
        <option value="comments-asc">ã‚³ãƒ¡ãƒ³ãƒˆ (å°‘ãªã„é †)</option>
      </select>
    </div>

    <div class="container" id="output"></div>

    <script>
      let videoData = [];

      // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
      //fetch("videolist20250204.csv")
      fetch("videolist20250423.csv")
        .then((response) => {
          if (!response.ok) {
            throw new Error("CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
          }
          return response.text();
        })
        .then((text) => {
          console.log("CSV èª­ã¿è¾¼ã¿æˆåŠŸ:", text);
          videoData = parseCSV(text);
          sortAndDisplay("date-desc");
        })
        .catch((error) => console.error("CSVã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", error.message));

      // CSVã‚’è§£æ
      function parseCSV(csvText) {
        const rows = csvText.split("\n").map((row) => row.split(","));

        return rows
          .slice(1)
          .map((row) => {
            // ç©ºè¡Œã‚„ã‚«ãƒ©ãƒ æ•°ãŒè¶³ã‚Šãªã„è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (row.length < 6 || row[0].trim() === "") return null;

            const dateObj = new Date(row[2]?.trim()); // ISO 8601å½¢å¼ã®æ—¥ä»˜ã‚’å‡¦ç†

            return {
              title: row[0]?.trim() || "No Title",
              url: row[1]?.trim() || "#",
              publishedDate:
                dateObj.toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" }) ||
                "2000-01-01", // æ—¥æœ¬æ™‚é–“ã§è¡¨ç¤º
              viewCount: parseInt(row[3]?.trim(), 10) || 0,
              likeCount: parseInt(row[4]?.trim(), 10) || 0,
              commentCount: parseInt(row[5]?.trim(), 10) || 0,
            };
          })
          .filter((video) => video !== null); // ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–
      }

      // ANDæ¤œç´¢æ©Ÿèƒ½
      function filterData() {
        const searchQuery = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const keywords = searchQuery.split(" ").filter(Boolean); // ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’åˆ†å‰²

        // ã‚¿ã‚¤ãƒˆãƒ«ã«ã™ã¹ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯
        const filteredData = videoData.filter((video) => {
          return keywords.every((keyword) =>
            video.title.toLowerCase().includes(keyword)
          );
        });

        sortAndDisplay("date-desc", filteredData); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¬é–‹æ—¥æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
      }

      // ã‚½ãƒ¼ãƒˆã¨è¡¨ç¤º (ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º)
      function sortAndDisplay(sortType, data = videoData) {
        const output = document.getElementById("output");
        output.innerHTML = "";

        let sortedData = [...data];

        switch (sortType) {
          case "date-desc":
            sortedData.sort(
              (a, b) => new Date(b.publishedDate) - new Date(a.publishedDate)
            );
            break;
          case "date-asc":
            sortedData.sort(
              (a, b) => new Date(a.publishedDate) - new Date(b.publishedDate)
            );
            break;
          case "views-desc":
            sortedData.sort((a, b) => b.viewCount - a.viewCount);
            break;
          case "views-asc":
            sortedData.sort((a, b) => a.viewCount - b.viewCount);
            break;
          case "likes-desc":
            sortedData.sort((a, b) => b.likeCount - a.likeCount);
            break;
          case "likes-asc":
            sortedData.sort((a, b) => a.likeCount - b.likeCount);
            break;
          case "comments-desc":
            sortedData.sort((a, b) => b.commentCount - a.commentCount);
            break;
          case "comments-asc":
            sortedData.sort((a, b) => a.commentCount - b.commentCount);
            break;
        }

        sortedData.forEach((video) => {
          const panel = document.createElement("a");
          panel.href = video.url;
          panel.target = "_blank";
          panel.className = "panel";
          panel.innerHTML = `
                    <strong>${video.title}</strong><br>
                    ğŸ“… å…¬é–‹æ—¥: ${video.publishedDate}<br>
                    ğŸ‘ï¸ å†ç”Ÿå›æ•°: ${video.viewCount}<br>
                    ğŸ‘ é«˜è©•ä¾¡: ${video.likeCount}<br>
                    ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ: ${video.commentCount}
                `;
          output.appendChild(panel);
        });
      }

      // ã‚½ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¤‰æ›´æ™‚ã«ä¸¦ã³æ›¿ãˆ
      document
        .getElementById("sortSelect")
        .addEventListener("change", function () {
          const searchQuery = document
            .getElementById("searchInput")
            .value.toLowerCase();
          const keywords = searchQuery.split(" ").filter(Boolean); // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’åˆ†å‰²
          const filteredData = videoData.filter((video) => {
            return keywords.every((keyword) =>
              video.title.toLowerCase().includes(keyword)
            );
          });
          sortAndDisplay(this.value, filteredData);
        });
    </script>
  </body>
</html>
